{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ikram/Desktop/clinical/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prisma ??\r\n  new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAMO,MAAM,SACX,OAAO,MAAM,IACb,IAAI,6IAAY;AAElB,wCAA2C,OAAO,MAAM,GAAG"}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ikram/Desktop/clinical/src/pages/api/auth/register.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport { prisma } from \"../../../lib/prisma\";\r\nimport { hash } from \"bcryptjs\";\r\nimport { z } from \"zod\";\r\n\r\nconst schema = z.object({\r\n  name: z.string().min(1),\r\n  email: z.string().email(),\r\n  password: z.string().min(6, \"Password must be at least 6 chars\"),\r\n  role: z.enum([\"ADMIN\", \"DOCTOR\", \"RECEPTIONIST\", \"PATIENT\"]).optional()\r\n});\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n\r\n  // ------------------------\r\n  // ðŸŽ¯ FIX CORS ICI\r\n  // ------------------------\r\n  res.setHeader(\"Access-Control-Allow-Origin\", \"http://localhost:3000\");\r\n  res.setHeader(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS\");\r\n  res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\r\n\r\n  // RÃ©pond au prÃ©flight OPTIONS\r\n  if (req.method === \"OPTIONS\") {\r\n    return res.status(200).end();\r\n  }\r\n  // ------------------------\r\n\r\n  if (req.method !== \"POST\")\r\n    return res.status(405).json({ error: \"Method not allowed\" });\r\n\r\n  const parse = schema.safeParse(req.body);\r\n  if (!parse.success)\r\n    return res.status(400).json({ error: parse.error.format() });\r\n\r\n  const { name, email, password, role } = parse.data;\r\n\r\n  const exists = await prisma.user.findUnique({ where: { email } });\r\n  if (exists) return res.status(409).json({ error: \"Email already exists\" });\r\n\r\n  const hashed = await hash(password, 10);\r\n\r\n  const user = await prisma.user.create({\r\n    data: {\r\n      name,\r\n      email,\r\n      password: hashed,\r\n      role: role as \"ADMIN\" | \"DOCTOR\" | \"RECEPTIONIST\" | \"PATIENT\"\r\n    }\r\n  });\r\n\r\n  let patient = null;\r\n  if ((role ?? \"PATIENT\") === \"PATIENT\") {\r\n    patient = await prisma.patient.create({\r\n      data: {\r\n        firstName: name.split(\" \")[0] || name,\r\n        lastName: name.split(\" \")[1] || \"\",\r\n        email,\r\n        owner: { connect: { id: user.id } }\r\n      }\r\n    });\r\n  }\r\n\r\n  return res.status(201).json({ message: \"User created\", user, patient });\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;;;;;;AAEA,MAAM,SAAS,2GAAC,CAAC,MAAM,CAAC;IACtB,MAAM,2GAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,OAAO,2GAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,2GAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,MAAM,2GAAC,CAAC,IAAI,CAAC;QAAC;QAAS;QAAU;QAAgB;KAAU,EAAE,QAAQ;AACvE;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAE7E,2BAA2B;IAC3B,kBAAkB;IAClB,2BAA2B;IAC3B,IAAI,SAAS,CAAC,+BAA+B;IAC7C,IAAI,SAAS,CAAC,gCAAgC;IAC9C,IAAI,SAAS,CAAC,gCAAgC;IAE9C,8BAA8B;IAC9B,IAAI,IAAI,MAAM,KAAK,WAAW;QAC5B,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAC5B;IACA,2BAA2B;IAE3B,IAAI,IAAI,MAAM,KAAK,QACjB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IAE5D,MAAM,QAAQ,OAAO,SAAS,CAAC,IAAI,IAAI;IACvC,IAAI,CAAC,MAAM,OAAO,EAChB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO,MAAM,KAAK,CAAC,MAAM;IAAG;IAE5D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI;IAElD,MAAM,SAAS,MAAM,uHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE;QAAM;IAAE;IAC/D,IAAI,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAuB;IAExE,MAAM,SAAS,MAAM,IAAA,wHAAI,EAAC,UAAU;IAEpC,MAAM,OAAO,MAAM,uHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;QACpC,MAAM;YACJ;YACA;YACA,UAAU;YACV,MAAM;QACR;IACF;IAEA,IAAI,UAAU;IACd,IAAI,CAAC,QAAQ,SAAS,MAAM,WAAW;QACrC,UAAU,MAAM,uHAAM,CAAC,OAAO,CAAC,MAAM,CAAC;YACpC,MAAM;gBACJ,WAAW,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI;gBACjC,UAAU,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI;gBAChC;gBACA,OAAO;oBAAE,SAAS;wBAAE,IAAI,KAAK,EAAE;oBAAC;gBAAE;YACpC;QACF;IACF;IAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,SAAS;QAAgB;QAAM;IAAQ;AACvE"}}]
}