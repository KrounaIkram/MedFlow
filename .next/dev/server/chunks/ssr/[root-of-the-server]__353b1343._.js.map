{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ikram/Desktop/clinical/src/pages/patient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getSession } from \"next-auth/react\";\r\nimport { toast } from \"sonner\";\r\n\r\ntype Consultation = {\r\n  id: string;\r\n  datetime: string;\r\n  diagnosis?: string;\r\n  notes?: string;\r\n  doctor: { name: string };\r\n};\r\n\r\ntype Appointment = {\r\n  id: string;\r\n  date: string;\r\n  type: string;\r\n  status: string;\r\n  doctor: { name: string };\r\n};\r\n\r\nexport default function PatientPage() {\r\n  const [consultations, setConsultations] = useState<Consultation[]>([]);\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Formulaire\r\n  const [doctorName, setDoctorName] = useState(\"\");\r\n  const [date, setDate] = useState(\"\");\r\n  const [type, setType] = useState(\"CONSULTATION\");\r\n  const [notes, setNotes] = useState(\"\");\r\n  const [creating, setCreating] = useState(false);\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      setLoading(true);\r\n      try {\r\n        const session = await getSession();\r\n        if (!session) return;\r\n\r\n        // Consultations\r\n        const consultRes = await fetch(\"/api/consultations\");\r\n        if (!consultRes.ok) throw new Error(\"Erreur chargement consultations\");\r\n        const consultData = await consultRes.json();\r\n        setConsultations(consultData);\r\n\r\n        // Rendez-vous\r\n        const apptRes = await fetch(\"/api/appointments\");\r\n        if (!apptRes.ok) throw new Error(\"Erreur chargement rendez-vous\");\r\n        const apptData = await apptRes.json();\r\n        setAppointments(apptData);\r\n      } catch (err) {\r\n        console.error(err);\r\n        toast.error(\"Erreur lors du chargement des données\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleCreateAppointment = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setCreating(true);\r\n\r\n    try {\r\n      const res = await fetch(\"/api/appointments\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          doctorName,\r\n          date,\r\n          type,\r\n          notes,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorData = await res.json();\r\n        throw new Error(errorData.error || \"Erreur création RDV\");\r\n      }\r\n\r\n      const newAppointment = await res.json();\r\n      toast.success(\"Rendez-vous créé avec succès !\");\r\n      setAppointments((prev) => [...prev, newAppointment.appointment]);\r\n\r\n      // Reset formulaire\r\n      setDoctorName(\"\");\r\n      setDate(\"\");\r\n      setType(\"CONSULTATION\");\r\n      setNotes(\"\");\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      toast.error(err.message || \"Erreur serveur\");\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      <h1 className=\"text-3xl font-bold mb-6 text-center\">Interface Patient</h1>\r\n\r\n      {loading ? (\r\n        <p>Chargement...</p>\r\n      ) : (\r\n        <>\r\n          {/* --- Consultations --- */}\r\n          <section className=\"mb-8\">\r\n            <h2 className=\"text-2xl font-semibold mb-4\">Mes Consultations</h2>\r\n            {consultations.length === 0 ? (\r\n              <p>Aucune consultation trouvée.</p>\r\n            ) : (\r\n              <ul className=\"space-y-3\">\r\n                {consultations.map((c) => (\r\n                  <li key={c.id} className=\"p-4 border rounded-lg shadow-sm\">\r\n                    <p><strong>Date :</strong> {new Date(c.datetime).toLocaleString()}</p>\r\n                    <p><strong>Docteur :</strong> {c.doctor.name}</p>\r\n                    {c.diagnosis && <p><strong>Diagnostic :</strong> {c.diagnosis}</p>}\r\n                    {c.notes && <p><strong>Notes :</strong> {c.notes}</p>}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </section>\r\n\r\n          {/* --- Rendez-vous --- */}\r\n          <section className=\"mb-8\">\r\n            <h2 className=\"text-2xl font-semibold mb-4\">Mes Rendez-vous</h2>\r\n            {appointments.length === 0 ? (\r\n              <p>Aucun rendez-vous trouvé.</p>\r\n            ) : (\r\n              <ul className=\"space-y-3\">\r\n                {appointments.map((a) => (\r\n                  <li key={a.id} className=\"p-4 border rounded-lg shadow-sm\">\r\n                    <p><strong>Date :</strong> {new Date(a.date).toLocaleString()}</p>\r\n                    <p><strong>Type :</strong> {a.type}</p>\r\n                    <p><strong>Docteur :</strong> {a.doctor.name}</p>\r\n                    <p><strong>Status :</strong> {a.status}</p>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </section>\r\n\r\n          {/* --- Formulaire création RDV --- */}\r\n          <section className=\"mb-8\">\r\n            <h2 className=\"text-2xl font-semibold mb-4\">Créer un Rendez-vous</h2>\r\n            <form onSubmit={handleCreateAppointment} className=\"space-y-4 p-4 border rounded-lg shadow-sm\">\r\n              <div>\r\n                <label className=\"block font-medium mb-1\">Docteur</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={doctorName}\r\n                  onChange={(e) => setDoctorName(e.target.value)}\r\n                  required\r\n                  className=\"w-full p-2 border rounded\"\r\n                  placeholder=\"Nom du docteur\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block font-medium mb-1\">Date & Heure</label>\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  value={date}\r\n                  onChange={(e) => setDate(e.target.value)}\r\n                  required\r\n                  className=\"w-full p-2 border rounded\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block font-medium mb-1\">Type de RDV</label>\r\n                <select value={type} onChange={(e) => setType(e.target.value)} className=\"w-full p-2 border rounded\">\r\n                  <option value=\"CONSULTATION\">Consultation</option>\r\n                  <option value=\"URGENCY\">Urgence</option>\r\n                  <option value=\"FOLLOW_UP\">Suivi</option>\r\n                  <option value=\"CONTROL\">Contrôle</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block font-medium mb-1\">Notes (facultatif)</label>\r\n                <textarea\r\n                  value={notes}\r\n                  onChange={(e) => setNotes(e.target.value)}\r\n                  className=\"w-full p-2 border rounded\"\r\n                />\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={creating}\r\n                className=\"w-full bg-blue-600 hover:bg-blue-800 text-white py-2 rounded-full\"\r\n              >\r\n                {creating ? \"Création...\" : \"Créer Rendez-vous\"}\r\n              </button>\r\n            </form>\r\n          </section>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}