{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ikram/Desktop/clinical/src/pages/doctor/dashboard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { format } from \"date-fns\";\r\n\r\ntype Appointment = {\r\n  id: string;\r\n  date: string;\r\n  type: string;\r\n  status: string;\r\n  notes?: string | null;\r\n  patient: { id: string; firstName: string; lastName: string };\r\n  doctor: { id: string; name: string };\r\n};\r\n\r\ntype Consultation = {\r\n  id: string;\r\n  diagnosis: string | null;\r\n  treatment: string | null;\r\n  notes: string | null;\r\n  datetime: string;\r\n  patient: { firstName: string; lastName: string };\r\n};\r\n\r\nexport default function DoctorDashboard() {\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [consultations, setConsultations] = useState<Consultation[]>([]);\r\n  const [selectedAppointment, setSelectedAppointment] = useState<Appointment | null>(null);\r\n  const [isConsultationOpen, setIsConsultationOpen] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    diagnosis: \"\",\r\n    treatment: \"\",\r\n    notes: \"\",\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const [apptRes, consultRes] = await Promise.all([\r\n        fetch(\"/api/appointments\"),\r\n        fetch(\"/api/consultations\"),\r\n      ]);\r\n      if (apptRes.ok) setAppointments(await apptRes.json());\r\n      if (consultRes.ok) setConsultations(await consultRes.json());\r\n    } catch (err) {\r\n      toast.error(\"Erreur chargement\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  // Filtrer les RDV du jour POUR CE MÉDECIN\r\n  const todayAppointments = appointments.filter(appt => {\r\n    const apptDate = new Date(appt.date);\r\n    return (\r\n      apptDate.toDateString() === new Date().toDateString() &&\r\n      [\"SCHEDULED\", \"CONFIRMED\"].includes(appt.status)\r\n    );\r\n  });\r\n\r\n  // Confirmer un RDV\r\n  const handleConfirm = async (id: string) => {\r\n    try {\r\n      const res = await fetch(`/api/appointments?id=${id}&action=confirm`, { method: \"POST\" });\r\n      if (res.ok) {\r\n        toast.success(\"RDV confirmé !\");\r\n        fetchData();\r\n      } else throw new Error();\r\n    } catch (err) {\r\n      toast.error(\"Erreur confirmation\");\r\n    }\r\n  };\r\n\r\n  // Annuler un RDV\r\n  const handleCancel = async (id: string) => {\r\n    try {\r\n      const res = await fetch(`/api/appointments?id=${id}&action=cancel`, { method: \"POST\" });\r\n      if (res.ok) {\r\n        toast.success(\"RDV annulé !\");\r\n        fetchData();\r\n      } else throw new Error();\r\n    } catch (err) {\r\n      toast.error(\"Erreur annulation\");\r\n    }\r\n  };\r\n\r\n  // Ouvrir le formulaire de consultation\r\n  const openConsultationForm = (appt: Appointment) => {\r\n    setSelectedAppointment(appt);\r\n    setIsConsultationOpen(true);\r\n    setFormData({ diagnosis: \"\", treatment: \"\", notes: \"\" });\r\n  };\r\n\r\n  // Soumettre la consultation\r\n  const handleSubmitConsultation = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!selectedAppointment) return;\r\n\r\n    try {\r\n      const res = await fetch(\"/api/consultations\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          appointmentId: selectedAppointment.id,\r\n          diagnosis: formData.diagnosis,\r\n          treatment: formData.treatment,\r\n          notes: formData.notes,\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        toast.success(\"Consultation enregistrée !\");\r\n        setIsConsultationOpen(false);\r\n        fetchData();\r\n      } else throw new Error();\r\n    } catch (err) {\r\n      toast.error(\"Erreur enregistrement\");\r\n    }\r\n  };\r\n\r\n  // Télécharger l'ordonnance PDF\r\n  const downloadPrescription = (consultationId: string) => {\r\n    window.open(`/api/prescriptions/pdf/${consultationId}`, \"_blank\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-6xl mx-auto\">\r\n      <h1 className=\"text-3xl font-bold mb-8 text-center\">Dashboard Médecin</h1>\r\n\r\n      {loading ? (\r\n        <p className=\"text-center\">Chargement...</p>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n          {/* Rendez-vous du jour */}\r\n          <section>\r\n            <h2 className=\"text-2xl font-semibold mb-4\">Rendez-vous Aujourd'hui</h2>\r\n            {todayAppointments.length === 0 ? (\r\n              <p>Aucun rendez-vous aujourd'hui.</p>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {todayAppointments.map(appt => (\r\n                  <div key={appt.id} className=\"p-4 border rounded-lg\">\r\n                    <p className=\"font-medium\">{appt.patient.firstName} {appt.patient.lastName}</p>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      {format(new Date(appt.date), \"HH:mm\")} • {appt.type}\r\n                    </p>\r\n                    <p className=\"text-sm mt-1\">\r\n                      <span className=\"font-semibold\">Statut:</span>{\" \"}\r\n                      <span className={\r\n                        appt.status === \"SCHEDULED\" \r\n                          ? \"text-yellow-600\" \r\n                          : appt.status === \"CONFIRMED\" \r\n                            ? \"text-green-600\" \r\n                            : \"text-red-600\"\r\n                      }>\r\n                        {appt.status}\r\n                      </span>\r\n                    </p>\r\n                    <div className=\"flex gap-2 mt-3\">\r\n                      {appt.status === \"SCHEDULED\" && (\r\n                        <>\r\n                          <button\r\n                            onClick={() => handleConfirm(appt.id)}\r\n                            className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm\"\r\n                          >\r\n                            Confirmer\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleCancel(appt.id)}\r\n                            className=\"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm\"\r\n                          >\r\n                            Annuler\r\n                          </button>\r\n                        </>\r\n                      )}\r\n                      {[\"SCHEDULED\", \"CONFIRMED\"].includes(appt.status) && (\r\n                        <button\r\n                          onClick={() => openConsultationForm(appt)}\r\n                          className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm\"\r\n                        >\r\n                          Consulter\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </section>\r\n\r\n          {/* Dernières consultations */}\r\n          <section>\r\n            <h2 className=\"text-2xl font-semibold mb-4\">Dernières Consultations</h2>\r\n            {consultations.length === 0 ? (\r\n              <p>Aucune consultation.</p>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {consultations.slice(0, 5).map(cons => (\r\n                  <div key={cons.id} className=\"p-4 border rounded-lg\">\r\n                    <p className=\"font-medium\">{cons.patient.firstName} {cons.patient.lastName}</p>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      {format(new Date(cons.datetime), \"dd/MM/yyyy HH:mm\")}\r\n                    </p>\r\n                    {cons.diagnosis && (\r\n                      <p className=\"mt-2 text-sm\">\r\n                        <span className=\"font-semibold\">Diagnostic:</span> {cons.diagnosis}\r\n                      </p>\r\n                    )}\r\n                    <button\r\n                      onClick={() => downloadPrescription(cons.id)}\r\n                      className=\"mt-2 bg-gray-700 hover:bg-gray-800 text-white px-3 py-1 rounded text-sm\"\r\n                    >\r\n                      Ordonnance PDF\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </section>\r\n        </div>\r\n      )}\r\n\r\n      {/* Modal Consultation */}\r\n      {isConsultationOpen && selectedAppointment && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-lg w-full max-w-2xl\">\r\n            <div className=\"p-6\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-xl font-bold\">\r\n                  Consultation - {selectedAppointment.patient.firstName} {selectedAppointment.patient.lastName}\r\n                </h2>\r\n                <button onClick={() => setIsConsultationOpen(false)}>✕</button>\r\n              </div>\r\n\r\n              <form onSubmit={handleSubmitConsultation} className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-1\">Diagnostic</label>\r\n                  <textarea\r\n                    value={formData.diagnosis}\r\n                    onChange={e => setFormData({ ...formData, diagnosis: e.target.value })}\r\n                    className=\"w-full p-2 border rounded\"\r\n                    rows={3}\r\n                    required\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-1\">Traitement</label>\r\n                  <textarea\r\n                    value={formData.treatment}\r\n                    onChange={e => setFormData({ ...formData, treatment: e.target.value })}\r\n                    className=\"w-full p-2 border rounded\"\r\n                    rows={3}\r\n                    required\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-1\">Notes</label>\r\n                  <textarea\r\n                    value={formData.notes}\r\n                    onChange={e => setFormData({ ...formData, notes: e.target.value })}\r\n                    className=\"w-full p-2 border rounded\"\r\n                    rows={2}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-3 pt-4\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setIsConsultationOpen(false)}\r\n                    className=\"px-4 py-2 border rounded\"\r\n                  >\r\n                    Annuler\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded\"\r\n                  >\r\n                    Enregistrer\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}