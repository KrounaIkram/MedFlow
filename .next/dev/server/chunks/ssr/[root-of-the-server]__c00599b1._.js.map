{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ikram/Desktop/clinical/src/pages/doctor.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport useSWR from \"swr\";\r\n\r\nconst fetcher = (url: string) => fetch(url, { credentials: \"include\" }).then(res => res.json());\r\n\r\nexport default function DoctorDashboard() {\r\n  const { data, mutate } = useSWR(\"/api/appointments?today=true\", fetcher);\r\n  const appointments = Array.isArray(data) ? data : []; // ✅ s'assure que c'est un tableau\r\n  const [selectedAppt, setSelectedAppt] = useState<any>(null);\r\n  const [diagnosis, setDiagnosis] = useState(\"\");\r\n  const [meds, setMeds] = useState([{ name: \"\", dosage: \"\", frequency: \"\", duration: \"\", notes: \"\" }]);\r\n  const [notes, setNotes] = useState(\"\");\r\n\r\n  const addMed = () =>\r\n    setMeds([...meds, { name: \"\", dosage: \"\", frequency: \"\", duration: \"\", notes: \"\" }]);\r\n\r\n  const saveConsultation = async () => {\r\n    if (!selectedAppt) return;\r\n\r\n    const res = await fetch(\"/api/consultations\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        appointmentId: selectedAppt.id,\r\n        diagnosis,\r\n        notes,\r\n        medications: meds.filter((m) => m.name),\r\n      }),\r\n    });\r\n\r\n    if (res.ok) {\r\n      alert(\"Consultation enregistrée ! PDF généré et envoyé au patient\");\r\n      mutate(); // recharge les rendez-vous\r\n      setSelectedAppt(null);\r\n      setDiagnosis(\"\");\r\n      setNotes(\"\");\r\n      setMeds([{ name: \"\", dosage: \"\", frequency: \"\", duration: \"\", notes: \"\" }]);\r\n    } else {\r\n      alert(\"Erreur lors de l'enregistrement de la consultation\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-8 max-w-6xl mx-auto\">\r\n      <h1 className=\"text-3xl font-bold mb-8\">Tableau de bord Médecin</h1>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n        {/* Liste RDV du jour */}\r\n        <div className=\"bg-white rounded-xl shadow-lg p-6\">\r\n          <h2 className=\"text-2xl font-bold mb-4\">RDV du jour</h2>\r\n\r\n          {appointments.length === 0 ? (\r\n            <p className=\"text-gray-500\">Aucun rendez-vous aujourd'hui</p>\r\n          ) : (\r\n            appointments.map((appt: any) => (\r\n              <div\r\n                key={appt.id}\r\n                className={`p-4 mb-3 rounded-lg border ${\r\n                  selectedAppt?.id === appt.id ? \"border-blue-500 bg-blue-50\" : \"border-gray-200\"\r\n                }`}\r\n              >\r\n                <div className=\"font-bold\">\r\n                  {appt.patient.firstName} {appt.patient.lastName}\r\n                </div>\r\n                <div>\r\n                  {new Date(appt.date).toLocaleTimeString(\"fr-FR\", {\r\n                    hour: \"2-digit\",\r\n                    minute: \"2-digit\",\r\n                  })}\r\n                </div>\r\n                <button\r\n                  onClick={() => setSelectedAppt(appt)}\r\n                  className=\"mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n                >\r\n                  Commencer la consultation\r\n                </button>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {/* Formulaire consultation */}\r\n        {selectedAppt && (\r\n          <div className=\"bg-white rounded-xl shadow-lg p-6\">\r\n            <h2 className=\"text-2xl font-bold mb-4\">\r\n              Consultation - {selectedAppt.patient.firstName} {selectedAppt.patient.lastName}\r\n            </h2>\r\n\r\n            {/* Diagnostic */}\r\n            <div className=\"mb-6\">\r\n              <label className=\"block font-bold mb-2\">Diagnostic</label>\r\n              <textarea\r\n                value={diagnosis}\r\n                onChange={(e) => setDiagnosis(e.target.value)}\r\n                className=\"w-full p-3 border rounded-lg\"\r\n                rows={4}\r\n                placeholder=\"Entrez le diagnostic...\"\r\n              />\r\n            </div>\r\n\r\n            {/* Ordonnance */}\r\n            <div className=\"mb-6\">\r\n              <label className=\"block font-bold mb-2\">Ordonnance</label>\r\n              {meds.map((med, i) => (\r\n                <div key={i} className=\"grid grid-cols-2 gap-3 mb-3 p-3 bg-gray-50 rounded\">\r\n                  <input\r\n                    placeholder=\"Nom du médicament\"\r\n                    value={med.name}\r\n                    onChange={(e) => {\r\n                      const newMeds = [...meds];\r\n                      newMeds[i].name = e.target.value;\r\n                      setMeds(newMeds);\r\n                    }}\r\n                  />\r\n                  <input\r\n                    placeholder=\"Dosage\"\r\n                    value={med.dosage}\r\n                    onChange={(e) => {\r\n                      const newMeds = [...meds];\r\n                      newMeds[i].dosage = e.target.value;\r\n                      setMeds(newMeds);\r\n                    }}\r\n                  />\r\n                  <input\r\n                    placeholder=\"Fréquence (ex: 3x/jour)\"\r\n                    value={med.frequency}\r\n                    onChange={(e) => {\r\n                      const newMeds = [...meds];\r\n                      newMeds[i].frequency = e.target.value;\r\n                      setMeds(newMeds);\r\n                    }}\r\n                  />\r\n                  <input\r\n                    placeholder=\"Durée (ex: 5 jours)\"\r\n                    value={med.duration}\r\n                    onChange={(e) => {\r\n                      const newMeds = [...meds];\r\n                      newMeds[i].duration = e.target.value;\r\n                      setMeds(newMeds);\r\n                    }}\r\n                  />\r\n                </div>\r\n              ))}\r\n              <button\r\n                onClick={addMed}\r\n                type=\"button\"\r\n                className=\"bg-gray-600 text-white px-4 py-2 rounded\"\r\n              >\r\n                + Ajouter médicament\r\n              </button>\r\n            </div>\r\n\r\n            {/* Notes supplémentaires */}\r\n            <div className=\"mb-6\">\r\n              <label className=\"block font-bold mb-2\">Notes supplémentaires</label>\r\n              <textarea\r\n                value={notes}\r\n                onChange={(e) => setNotes(e.target.value)}\r\n                className=\"w-full p-3 border rounded-lg\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n\r\n            <button\r\n              onClick={saveConsultation}\r\n              className=\"bg-green-600 text-white px-8 py-4 rounded-lg text-xl font-bold hover:bg-green-700\"\r\n            >\r\n              Terminer & Générer le PDF\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}